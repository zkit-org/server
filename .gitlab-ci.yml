stages:
    - package
    - deploy

package:
    stage: package
    only:
        variables:
            - $SERVICE == "account"
    tags:
        - dev
    script:
        - mvn clean install
        - cd server-$SERVICE/server-$SERVICE-service
        - mvn package
        - docker build -t zkit-server-$SERVICE:$CI_PIPELINE_IID -f ./Dockerfile .
        - docker tag zkit-server-$SERVICE:$CI_PIPELINE_IID zkit-server-$SERVICE:latest

deploy:
    stage: deploy
    only:
        variables:
            - $SERVICE == "account"
    tags:
        - dev
    script:
        - cd /opt/zkit/test/server-$SERVICE
        - docker-compose down
        - docker-compose up -d
